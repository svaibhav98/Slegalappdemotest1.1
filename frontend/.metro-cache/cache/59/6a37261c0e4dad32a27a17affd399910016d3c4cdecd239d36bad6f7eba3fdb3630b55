{"dependencies":[{"name":"./load-balancer","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":20,"column":24,"index":758},"end":{"line":20,"column":50,"index":784}}],"key":"uOBAJTyNQHYWLk8tq5Ek7vETkD0=","exportNames":["*"],"imports":1}},{"name":"./connectivity-state","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":21,"column":29,"index":815},"end":{"line":21,"column":60,"index":846}}],"key":"jyxLDTe7V7Ou6ov9nXyoEe1g9Sg=","exportNames":["*"],"imports":1}},{"name":"./picker","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":22,"column":17,"index":865},"end":{"line":22,"column":36,"index":884}}],"key":"drq9s9jHKAQmdw2pWLLHD5nwu4I=","exportNames":["*"],"imports":1}},{"name":"./subchannel-address","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":23,"column":29,"index":915},"end":{"line":23,"column":60,"index":946}}],"key":"s7maFfe6oUZ6E4vQAG2rWwUHpfM=","exportNames":["*"],"imports":1}},{"name":"./logging","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":24,"column":16,"index":964},"end":{"line":24,"column":36,"index":984}}],"key":"IuCQ7u+XFj9mcNQiMAuOpQn/EDM=","exportNames":["*"],"imports":1}},{"name":"./constants","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":25,"column":20,"index":1006},"end":{"line":25,"column":42,"index":1028}}],"key":"3z43bJyk/UB4EKjDCOXTFak09do=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function(g,r,i,a,m,e,d){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),e.setup=e.RoundRobinLoadBalancer=void 0;const t=r(d[0]),n=r(d[1]),s=r(d[2]),c=r(d[3]),l=r(d[4]),o=r(d[5]);function h(t){l.trace(o.LogVerbosity.DEBUG,\"round_robin\",t)}const u='round_robin';class S{getLoadBalancerName(){return u}constructor(){}toJsonObject(){return{[u]:{}}}static createFromJson(t){return new S}}class C{constructor(t,n=0){this.subchannelList=t,this.nextIndex=n}pick(t){const n=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:n,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class b{constructor(t){this.channelControlHelper=t,this.subchannels=[],this.currentState=n.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,s,c,l,o)=>{this.calculateAndUpdateState(),c!==n.ConnectivityState.TRANSIENT_FAILURE&&c!==n.ConnectivityState.IDLE||(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(t){return this.subchannels.filter(n=>n.getConnectivityState()===t).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(n.ConnectivityState.READY)>0){const t=this.subchannels.filter(t=>t.getConnectivityState()===n.ConnectivityState.READY);let s=0;null!==this.currentReadyPicker&&(s=t.indexOf(this.currentReadyPicker.peekNextSubchannel()),s<0&&(s=0)),this.updateState(n.ConnectivityState.READY,new C(t,s))}else this.countSubchannelsWithState(n.ConnectivityState.CONNECTING)>0?this.updateState(n.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(n.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(n.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(n.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(t,s){h(n.ConnectivityState[this.currentState]+' -> '+n.ConnectivityState[t]),t===n.ConnectivityState.READY?this.currentReadyPicker=s:this.currentReadyPicker=null,this.currentState=t,this.channelControlHelper.updateState(t,s)}resetSubchannelList(){for(const t of this.subchannels)t.removeConnectivityStateListener(this.subchannelStateListener),t.unref(),this.channelControlHelper.removeChannelzChild(t.getChannelzRef());this.subchannels=[]}updateAddressList(t,s){this.resetSubchannelList(),h('Connect to address list '+t.map(t=>(0,c.subchannelAddressToString)(t))),this.subchannels=t.map(t=>this.channelControlHelper.createSubchannel(t,{}));for(const t of this.subchannels){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());const s=t.getConnectivityState();s!==n.ConnectivityState.IDLE&&s!==n.ConnectivityState.TRANSIENT_FAILURE||t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(const t of this.subchannels)t.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return u}}e.RoundRobinLoadBalancer=b,e.setup=function(){(0,t.registerLoadBalancerType)(u,b,S)}});","lineCount":1,"map":[[1,28,1,0],[1,41,18,0,"Object"],[1,48,18,7,"defineProperty"],[1,63,18,22,"exports"],[1,65,18,31],[1,78,18,45],[1,79,18,47,"value"],[1,86,18,54],[1,90,19,0,"exports"],[1,92,19,8,"setup"],[1,98,19,16,"exports"],[1,100,19,24,"RoundRobinLoadBalancer"],[1,128,19,46,"undefined"],[1,130,20,0],[1,136,20,6,"load_balancer_1"],[1,138,20,24,"require"],[1,140,20,31,"d"],[1,142,20,31],[1,146,21,6,"connectivity_state_1"],[1,148,21,29,"require"],[1,150,21,36,"d"],[1,152,21,36],[1,156,22,6,"picker_1"],[1,158,22,17,"require"],[1,160,22,24,"d"],[1,162,22,24],[1,166,23,6,"subchannel_address_1"],[1,168,23,29,"require"],[1,170,23,36,"d"],[1,172,23,36],[1,176,24,6,"logging"],[1,178,24,16,"require"],[1,180,24,23,"d"],[1,182,24,23],[1,186,25,6,"constants_1"],[1,188,25,20,"require"],[1,190,25,27,"d"],[1,192,25,27],[1,196,27,0],[1,205,27,9,"trace"],[1,207,27,15,"text"],[1,210,28,4,"logging"],[1,212,28,12,"trace"],[1,218,28,18,"constants_1"],[1,220,28,30,"LogVerbosity"],[1,233,28,43,"DEBUG"],[1,239,26,20],[1,253,28,63,"text"],[1,255,29,0],[1,256,30,0],[1,262,30,6,"TYPE_NAME"],[1,264,30,18],[1,278,31,0],[1,284,31,6,"RoundRobinLoadBalancingConfig"],[1,286,32,4,"getLoadBalancerName"],[1,308,33,8],[1,315,33,15,"TYPE_NAME"],[1,316,34,4],[1,317,35,4,"constructor"],[1,331,35,20],[1,332,36,4,"toJsonObject"],[1,347,37,8],[1,353,37,15],[1,354,38,12,"TYPE_NAME"],[1,355,38,13,"TYPE_NAME"],[1,358,38,25],[1,359,38,26],[1,361,40,4],[1,362,42,4],[1,383,42,11,"createFromJson"],[1,384,42,26,"obj"],[1,387,43,8],[1,394,43,15],[1,398,43,19,"RoundRobinLoadBalancingConfig"],[1,399,44,4],[1,401,46,0],[1,407,46,6,"RoundRobinPicker"],[1,409,47,4,"constructor"],[1,421,47,16,"subchannelList"],[1,423,47,32,"nextIndex"],[1,425,47,44],[1,428,48,8,"this"],[1,433,48,13,"subchannelList"],[1,448,48,30,"subchannelList"],[1,450,49,8,"this"],[1,455,49,13,"nextIndex"],[1,465,49,25,"nextIndex"],[1,466,50,4],[1,467,51,4,"pick"],[1,472,51,9,"pickArgs"],[1,475,52,8],[1,481,52,14,"pickedSubchannel"],[1,483,52,33,"this"],[1,488,52,38,"subchannelList"],[1,503,52,53,"this"],[1,508,52,58,"nextIndex"],[1,519,54,8],[1,526,53,8,"this"],[1,531,53,13,"nextIndex"],[1,542,53,26,"this"],[1,547,53,31,"nextIndex"],[1,557,53,43],[1,560,53,48,"this"],[1,565,53,53,"subchannelList"],[1,580,53,68,"length"],[1,587,54,15],[1,588,55,12,"pickResultType"],[1,603,55,28,"picker_1"],[1,605,55,37,"PickResultType"],[1,620,55,52,"COMPLETE"],[1,629,56,12,"subchannel"],[1,640,56,24,"pickedSubchannel"],[1,642,57,12,"status"],[1,649,57,20],[1,654,58,12,"onCallStarted"],[1,668,58,27],[1,673,59,12,"onCallEnded"],[1,685,59,25],[1,690,61,4],[1,691,67,4,"peekNextSubchannel"],[1,712,68,8],[1,719,68,15,"this"],[1,724,68,20,"subchannelList"],[1,739,68,35,"this"],[1,744,68,40,"nextIndex"],[1,754,69,4],[1,756,71,0],[1,762,71,6,"RoundRobinLoadBalancer"],[1,764,72,4,"constructor"],[1,776,72,16,"channelControlHelper"],[1,779,73,8,"this"],[1,784,73,13,"channelControlHelper"],[1,805,73,36,"channelControlHelper"],[1,807,74,8,"this"],[1,812,74,13,"subchannels"],[1,824,74,27],[1,827,75,8,"this"],[1,832,75,13,"currentState"],[1,845,75,28,"connectivity_state_1"],[1,847,75,49,"ConnectivityState"],[1,865,75,67,"IDLE"],[1,870,76,8,"this"],[1,875,76,13,"currentReadyPicker"],[1,894,76,34],[1,899,77,8,"this"],[1,904,77,13,"lastError"],[1,914,77,25],[1,919,78,8,"this"],[1,924,78,13,"subchannelStateListener"],[1,948,78,39],[1,949,78,40,"subchannel"],[1,951,78,52,"previousState"],[1,953,78,67,"newState"],[1,955,78,77,"keepaliveTime"],[1,957,78,92,"errorMessage"],[1,962,79,12,"this"],[1,967,79,17,"calculateAndUpdateState"],[1,993,80,16,"newState"],[1,997,80,29,"connectivity_state_1"],[1,999,80,50,"ConnectivityState"],[1,1017,80,68,"TRANSIENT_FAILURE"],[1,1036,81,16,"newState"],[1,1040,81,29,"connectivity_state_1"],[1,1042,81,50,"ConnectivityState"],[1,1060,81,68,"IDLE"],[1,1067,82,20,"errorMessage"],[1,1071,83,20,"this"],[1,1076,83,25,"lastError"],[1,1086,83,37,"errorMessage"],[1,1089,85,16,"this"],[1,1094,85,21,"channelControlHelper"],[1,1115,85,42,"requestReresolution"],[1,1137,86,16,"subchannel"],[1,1139,86,27,"startConnecting"],[1,1158,89,4],[1,1159,90,4,"countSubchannelsWithState"],[1,1185,90,30,"state"],[1,1188,91,8],[1,1195,91,15,"this"],[1,1200,91,20,"subchannels"],[1,1212,91,32,"filter"],[1,1219,91,39,"subchannel"],[1,1222,91,53,"subchannel"],[1,1224,91,64,"getConnectivityState"],[1,1249,91,91,"state"],[1,1252,91,98,"length"],[1,1258,92,4],[1,1259,93,4,"calculateAndUpdateState"],[1,1285,94,8],[1,1288,94,12,"this"],[1,1293,94,17,"countSubchannelsWithState"],[1,1319,94,43,"connectivity_state_1"],[1,1321,94,64,"ConnectivityState"],[1,1339,94,82,"READY"],[1,1346,94,91],[1,1348,94,94],[1,1349,95,12],[1,1355,95,18,"readySubchannels"],[1,1357,95,37,"this"],[1,1362,95,42,"subchannels"],[1,1374,95,54,"filter"],[1,1381,95,61,"subchannel"],[1,1384,95,75,"subchannel"],[1,1386,95,86,"getConnectivityState"],[1,1411,95,113,"connectivity_state_1"],[1,1413,95,134,"ConnectivityState"],[1,1431,95,152,"READY"],[1,1438,96,12],[1,1442,96,16,"index"],[1,1444,96,24],[1,1446,97,44],[1,1453,97,16,"this"],[1,1458,97,21,"currentReadyPicker"],[1,1479,98,16,"index"],[1,1481,98,24,"readySubchannels"],[1,1483,98,41,"indexOf"],[1,1491,98,49,"this"],[1,1496,98,54,"currentReadyPicker"],[1,1515,98,73,"peekNextSubchannel"],[1,1537,99,20,"index"],[1,1539,99,28],[1,1543,100,20,"index"],[1,1545,100,28],[1,1549,103,12,"this"],[1,1554,103,17,"updateState"],[1,1566,103,29,"connectivity_state_1"],[1,1568,103,50,"ConnectivityState"],[1,1586,103,68,"READY"],[1,1592,103,75],[1,1596,103,79,"RoundRobinPicker"],[1,1598,103,96,"readySubchannels"],[1,1600,103,114,"index"],[1,1603,104,8],[1,1609,105,17,"this"],[1,1614,105,22,"countSubchannelsWithState"],[1,1640,105,48,"connectivity_state_1"],[1,1642,105,69,"ConnectivityState"],[1,1660,105,87,"CONNECTING"],[1,1672,105,101],[1,1674,106,12,"this"],[1,1679,106,17,"updateState"],[1,1691,106,29,"connectivity_state_1"],[1,1693,106,50,"ConnectivityState"],[1,1711,106,68,"CONNECTING"],[1,1722,106,80],[1,1726,106,84,"picker_1"],[1,1728,106,93,"QueuePicker"],[1,1740,106,105,"this"],[1,1747,108,17,"this"],[1,1752,108,22,"countSubchannelsWithState"],[1,1778,108,48,"connectivity_state_1"],[1,1780,108,69,"ConnectivityState"],[1,1798,108,87,"TRANSIENT_FAILURE"],[1,1817,108,108],[1,1819,109,12,"this"],[1,1824,109,17,"updateState"],[1,1836,109,29,"connectivity_state_1"],[1,1838,109,50,"ConnectivityState"],[1,1856,109,68,"TRANSIENT_FAILURE"],[1,1874,109,87],[1,1878,109,91,"picker_1"],[1,1880,109,100,"UnavailablePicker"],[1,1898,109,118],[1,1899,109,120,"details"],[1,1907,109,129],[1,1949,109,171,"this"],[1,1954,109,176,"lastError"],[1,1969,112,12,"this"],[1,1974,112,17,"updateState"],[1,1986,112,29,"connectivity_state_1"],[1,1988,112,50,"ConnectivityState"],[1,2006,112,68,"IDLE"],[1,2011,112,74],[1,2015,112,78,"picker_1"],[1,2017,112,87,"QueuePicker"],[1,2029,112,99,"this"],[1,2035,114,4],[1,2036,115,4,"updateState"],[1,2048,115,16,"newState"],[1,2050,115,26,"picker"],[1,2053,116,8,"trace"],[1,2055,116,14,"connectivity_state_1"],[1,2057,116,35,"ConnectivityState"],[1,2075,116,53,"this"],[1,2080,116,58,"currentState"],[1,2094,117,12],[1,2101,118,12,"connectivity_state_1"],[1,2103,118,33,"ConnectivityState"],[1,2121,118,51,"newState"],[1,2125,119,12,"newState"],[1,2129,119,25,"connectivity_state_1"],[1,2131,119,46,"ConnectivityState"],[1,2149,119,64,"READY"],[1,2155,120,12,"this"],[1,2160,120,17,"currentReadyPicker"],[1,2179,120,38,"picker"],[1,2181,123,12,"this"],[1,2186,123,17,"currentReadyPicker"],[1,2205,123,38],[1,2210,125,8,"this"],[1,2215,125,13,"currentState"],[1,2228,125,28,"newState"],[1,2230,126,8,"this"],[1,2235,126,13,"channelControlHelper"],[1,2256,126,34,"updateState"],[1,2268,126,46,"newState"],[1,2270,126,56,"picker"],[1,2272,127,4],[1,2273,128,4,"resetSubchannelList"],[1,2295,129,8],[1,2299,129,13],[1,2305,129,19,"subchannel"],[1,2310,129,33,"this"],[1,2315,129,38,"subchannels"],[1,2327,130,12,"subchannel"],[1,2329,130,23,"removeConnectivityStateListener"],[1,2361,130,55,"this"],[1,2366,130,60,"subchannelStateListener"],[1,2391,131,12,"subchannel"],[1,2393,131,23,"unref"],[1,2401,132,12,"this"],[1,2406,132,17,"channelControlHelper"],[1,2427,132,38,"removeChannelzChild"],[1,2447,132,58,"subchannel"],[1,2449,132,69,"getChannelzRef"],[1,2467,134,8,"this"],[1,2472,134,13,"subchannels"],[1,2484,134,27],[1,2486,135,4],[1,2487,136,4,"updateAddressList"],[1,2505,136,22,"addressList"],[1,2507,136,35,"lbConfig"],[1,2510,137,8,"this"],[1,2515,137,13,"resetSubchannelList"],[1,2537,138,8,"trace"],[1,2539,138,14],[1,2566,139,12,"addressList"],[1,2568,139,24,"map"],[1,2572,139,28,"address"],[1,2576,139,39],[1,2578,139,43,"subchannel_address_1"],[1,2580,139,64,"subchannelAddressToString"],[1,2607,139,91,"address"],[1,2612,140,8,"this"],[1,2617,140,13,"subchannels"],[1,2629,140,27,"addressList"],[1,2631,140,39,"map"],[1,2635,140,43,"address"],[1,2638,140,54,"this"],[1,2643,140,59,"channelControlHelper"],[1,2664,140,80,"createSubchannel"],[1,2681,140,97,"address"],[1,2683,140,106],[1,2684,140,107],[1,2688,141,8],[1,2692,141,13],[1,2698,141,19,"subchannel"],[1,2703,141,33,"this"],[1,2708,141,38,"subchannels"],[1,2720,141,51],[1,2721,142,12,"subchannel"],[1,2723,142,23,"ref"],[1,2729,143,12,"subchannel"],[1,2731,143,23,"addConnectivityStateListener"],[1,2760,143,52,"this"],[1,2765,143,57,"subchannelStateListener"],[1,2790,144,12,"this"],[1,2795,144,17,"channelControlHelper"],[1,2816,144,38,"addChannelzChild"],[1,2833,144,55,"subchannel"],[1,2835,144,66,"getChannelzRef"],[1,2853,145,12],[1,2859,145,18,"subchannelState"],[1,2861,145,36,"subchannel"],[1,2863,145,47,"getConnectivityState"],[1,2886,146,16,"subchannelState"],[1,2890,146,36,"connectivity_state_1"],[1,2892,146,57,"ConnectivityState"],[1,2910,146,75,"IDLE"],[1,2916,147,16,"subchannelState"],[1,2920,147,36,"connectivity_state_1"],[1,2922,147,57,"ConnectivityState"],[1,2940,147,75,"TRANSIENT_FAILURE"],[1,2959,148,16,"subchannel"],[1,2961,148,27,"startConnecting"],[1,2978,150,8],[1,2979,151,8,"this"],[1,2984,151,13,"calculateAndUpdateState"],[1,3009,152,4],[1,3010,153,4,"exitIdle"],[1,3021,154,8],[1,3025,154,13],[1,3031,154,19,"subchannel"],[1,3036,154,33,"this"],[1,3041,154,38,"subchannels"],[1,3053,155,12,"subchannel"],[1,3055,155,23,"startConnecting"],[1,3072,157,4],[1,3073,158,4,"resetBackoff"],[1,3088,159,8],[1,3089,162,4,"destroy"],[1,3099,163,8,"this"],[1,3104,163,13,"resetSubchannelList"],[1,3125,164,4],[1,3126,165,4,"getTypeName"],[1,3140,166,8],[1,3147,166,15,"TYPE_NAME"],[1,3148,167,4],[1,3150,169,0,"exports"],[1,3152,169,8,"RoundRobinLoadBalancer"],[1,3175,169,33,"RoundRobinLoadBalancer"],[1,3177,173,0,"exports"],[1,3179,173,8,"setup"],[1,3185,170,0],[1,3197,171,4],[1,3199,171,8,"load_balancer_1"],[1,3201,171,24,"registerLoadBalancerType"],[1,3227,171,50,"TYPE_NAME"],[1,3229,171,61,"RoundRobinLoadBalancer"],[1,3231,171,85,"RoundRobinLoadBalancingConfig"],[1,3233,172,0],[1,3234,173,22],[1,3237]],"functionMap":{"names":["<global>","trace","RoundRobinLoadBalancingConfig","RoundRobinLoadBalancingConfig#getLoadBalancerName","RoundRobinLoadBalancingConfig#constructor","RoundRobinLoadBalancingConfig#toJsonObject","RoundRobinLoadBalancingConfig.createFromJson","RoundRobinPicker","RoundRobinPicker#constructor","RoundRobinPicker#pick","RoundRobinPicker#peekNextSubchannel","RoundRobinLoadBalancer","RoundRobinLoadBalancer#constructor","subchannelStateListener","RoundRobinLoadBalancer#countSubchannelsWithState","subchannels.filter$argument_0","RoundRobinLoadBalancer#calculateAndUpdateState","RoundRobinLoadBalancer#updateState","RoundRobinLoadBalancer#resetSubchannelList","RoundRobinLoadBalancer#updateAddressList","addressList.map$argument_0","RoundRobinLoadBalancer#exitIdle","RoundRobinLoadBalancer#resetBackoff","RoundRobinLoadBalancer#destroy","RoundRobinLoadBalancer#getTypeName","setup"],"mappings":"AAA;AC0B;CDE;AEE;ICC;KDE;IEC,iBF;IGC;KHI;IIE;KJE;CFC;AOC;ICC;KDG;IEC;KFU;IGM;KHE;CPC;AWC;ICC;uCCM;SDU;KDC;IGC;uCCC,yDD;KHC;IKC;6DDE,gGC;KLmB;IMC;KNY;IOC;KPO;IQC;4BCG,uED;2CCC,kED;KRY;IUC;KVI;IWC;KXG;IYC;KZE;IaC;KbE;CXC;AyBE;CzBE"},"hasCjsExports":true},"type":"js/module"}]}